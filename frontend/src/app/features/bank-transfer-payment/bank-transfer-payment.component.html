<app-header></app-header>

<div class="container mt-4 mb-5">
    <div class="page-header">
        <h1>Thông tin Thanh toán Chuyển khoản</h1>
        <p>Vui lòng chuyển khoản theo thông tin dưới đây để hoàn tất đơn hàng.</p>
    </div>

    <!-- Loading -->
    <div *ngIf="isLoading" class="text-center p-5">
        <div class="spinner-border text-primary" role="status"><span class="visually-hidden">Đang tải...</span></div>
        <p class="mt-3">Đang tải thông tin thanh toán...</p>
    </div>

  
    <div *ngIf="errorMessage && !isLoading" class="alert alert-danger">
        <i class="fas fa-exclamation-circle me-2"></i> {{ errorMessage }}
        <button class="btn btn-sm btn-link text-danger float-end" (click)="goToHome()">Về trang chủ</button>
    </div>

    <!-- Nội dung chính: Chỉ hiển thị khi không loading, không lỗi, và có cả order và bankInfo -->
    <div *ngIf="!isLoading && !errorMessage && order && bankInfo" class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            <div class="card shadow-sm payment-card">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <!-- Hiển thị orderCode nếu có, nếu không thì hiển thị serialId -->
                    <h5 class="mb-0">Đơn hàng #{{ order.orderCode ?? order.serialId }}</h5>
                    <!-- Sử dụng hàm getStatusBadgeClass và hiển thị statusDescription -->
                    <span class="badge rounded-pill {{ getStatusBadgeClass(order.statusCode) }}">{{
                        order.statusDescription ?? order.statusCode }}</span>
                </div>

                <div class="card-body">
                    <div class="alert alert-info small p-3" role="alert">
                        <i class="fas fa-info-circle me-2"></i>
                        Đơn hàng của bạn đã được ghi nhận. Vui lòng hoàn tất chuyển khoản trong vòng **24 giờ** để chúng
                        tôi xử lý đơn hàng.
                    </div>

                    <h5 class="mt-4 mb-3 section-title">Thông tin chuyển khoản <i
                            class="fas fa-university ms-2 text-primary"></i></h5>
                    <div class="bank-info-box p-3 border rounded bg-light mb-4">
                        <div class="info-row"><span>Ngân hàng:</span> <strong>{{ bankInfo.bankName }} {{
                                bankInfo.bankBranch ? '('+bankInfo.bankBranch+')' : '' }}</strong></div>
                        <div class="info-row position-relative">
                            <span>Số tài khoản:</span>
                            <strong class="text-primary account-number">{{ bankInfo.accountNumber }}</strong>
                            <button class="btn btn-sm btn-outline-secondary copy-btn" title="Sao chép số tài khoản"
                                (click)="copyToClipboard(bankInfo.accountNumber)">
                                <i class="far fa-copy"></i>
                            </button>
                        </div>
                        <!-- Hiển thị accountName -->
                        <div class="info-row"><span>Chủ tài khoản:</span> <strong>{{ bankInfo.accountName }}</strong>
                        </div>
                        <hr class="my-3">
                        <!-- Sử dụng currency pipe cho totalAmount -->
                        <div class="info-row"><span>Số tiền:</span> <strong class="text-danger amount">{{
                                order.totalAmount | currency:'VND':'symbol':'1.0-0' }}</strong></div>
                        <div class="info-row position-relative">
                            <span>Nội dung <small>(Bắt buộc)</small>:</span>
                            <!-- Hiển thị transferContent đã tạo -->
                            <strong class="text-danger transfer-content">{{ transferContent }}</strong>
                            <button class="btn btn-sm btn-outline-secondary copy-btn" title="Sao chép nội dung"
                                (click)="copyToClipboard(transferContent)">
                                <i class="far fa-copy"></i>
                            </button>
                        </div>
                        <small class="text-muted mt-2 d-block">Vui lòng ghi **chính xác** nội dung chuyển
                            khoản...</small>
                    </div>

                    <h5 class="mt-4 mb-3 section-title">Tóm tắt đơn hàng <i
                            class="fas fa-receipt ms-2 text-primary"></i></h5>
                    <ul class="list-group list-group-flush small">
                        <li class="list-group-item d-flex justify-content-between px-0">
                            <span>Ngày đặt:</span>
                            <!-- Sử dụng date pipe -->
                            <span>{{ order.orderDate | date:'HH:mm dd/MM/yyyy' }}</span>
                        </li>
                        <!-- Hiển thị customerName -->
                        <li class="list-group-item d-flex justify-content-between px-0">
                            <span>Người nhận:</span>
                            <span>{{ order.customerName }}</span>
                        </li>
                        <!-- Lặp qua order.items -->
                        <li class="list-group-item d-flex justify-content-between px-0"
                            *ngFor="let item of order.items">
                            <span>{{ item.productName }} x {{ item.quantity }}</span>
                            <!-- Tính và dùng currency pipe cho tổng tiền từng item -->
                            <span>{{ (item.productPrice * item.quantity) | currency:'VND':'symbol':'1.0-0' }}</span>
                        </li>
                        <li
                            class="list-group-item d-flex justify-content-between fw-bold border-top pt-2 mt-2 px-0 fs-6">
                            <span>Tổng cộng</span>
                            <!-- Sử dụng currency pipe cho tổng tiền đơn hàng -->
                            <span>{{ order.totalAmount | currency:'VND':'symbol':'1.0-0' }}</span>
                        </li>
                    </ul>

                    <!-- ... Phần nút bấm ... -->
                    <div class="mt-4 pt-3 border-top text-center button-group">
                        <button class="btn btn-outline-secondary me-2" (click)="goToHome()">
                            <i class="fas fa-home me-1"></i> Quay về Trang chủ
                        </button>
                        <button class="btn btn-success" (click)="confirmPayment()">
                            <i class="fas fa-check-circle me-1"></i> Tôi đã chuyển khoản
                        </button>
                        <p class="mt-3 text-muted small">Chúng tôi sẽ kiểm tra và cập nhật trạng thái đơn hàng...</p>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<app-footer></app-footer>