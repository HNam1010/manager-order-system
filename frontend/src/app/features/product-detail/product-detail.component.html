<app-header></app-header>

<div class="container mt-4 mb-5">

    <!-- Nút quay lại -->
    <button class="btn btn-outline-secondary btn-sm mb-3" (click)="goBack()">
        <i class="fas fa-arrow-left me-2"></i> Quay lại
    </button>

    <!-- Loading -->
    <div *ngIf="isLoading" class="text-center p-5">
        <div class="spinner-border text-primary loading"  role="status">
            <span class="visually-hidden">Đang tải...</span>
        </div>
        <p class="mt-3">Đang tải chi tiết sản phẩm...</p>
    </div>

    <!-- Error -->
    <div *ngIf="errorMessage && !isLoading" class="alert alert-danger" role="alert">
        <i class="fas fa-exclamation-circle me-2"></i> {{ errorMessage }}
        <!-- Có thể thêm nút quay lại trang chủ -->
        <button class="btn btn-sm btn-link text-danger float-end" (click)="router.navigate(['/'])">Về trang chủ</button>
    </div>

    <!-- Nội dung chi tiết sản phẩm -->
    <div *ngIf="product && !isLoading && !errorMessage" class="product-detail-container row">
        <!-- Cột ảnh -->
        <div class="col-md-6 mb-3 mb-md-0 text-center image-zoom-container"> 

            <img [src]="getProductImageUrl(product.imagePath)" 
                 alt="{{ product.name }}"
                 class="img-fluid product-detail-image rounded shadow-sm"
                 (mousemove)="onMouseMove($event)" 
                 (mouseleave)="onMouseLeave()"
                 (error)="onImageError($event)" >     

                <div
                    *ngIf="showZoom"
                    class="zoom-lens"
                    [style.background-image]="'url(' + getProductImageUrl(product.imagePath) + ')'"
                    [style.backgroundPosition]="backgroundPosition"
                    [style.top]="zoomPosition.top"
                    [style.left]="zoomPosition.left"
                ></div>


        </div>
    
        <!-- Cột thông tin -->
        <div class="col-md-6 product-info">
            <h1 class="product-title mb-2">{{ product.name }}</h1>
            <p class="text-muted mb-3">Thương hiệu: <strong>{{ product.brand || 'N/A' }}</strong> | Loại: <strong>{{ product.productTypeName || 'N/A' }}</strong></p> <!-- Hiển thị loại SP -->

             <!-- Rating-->
             <div class="product-rating mb-3">
                 <span class="text-warning">
                     <i class="fa-solid fa-star"></i>
                     <i class="fa-solid fa-star"></i>
                     <i class="fa-solid fa-star"></i>
                     <i class="fa-solid fa-star"></i>
                     <i class="fa-solid fa-star-half-stroke"></i>
                 </span>
             </div>

            <h3 class="product-price text-danger fw-bold mb-3">{{ product.price | number:'1.0-0' }} VNĐ</h3>
            
            <p class="product-stock mb-3">
                Tình trạng:
                <span [ngClass]="{'text-success': product.quantity > 0, 'text-danger': product.quantity <= 0}">
                    <i class="fas" [ngClass]="{'fa-check-circle': product.quantity > 0, 'fa-times-circle': product.quantity <= 0}"></i>
                    {{ product.quantity > 0 ? 'Còn hàng' : 'Cháy hàng' }} ({{ product.quantity }} sản phẩm)
                </span>
            </p>
            <!--THÊM PHẦN HIỂN THỊ SIZE-->
            <p class="product-size mb-3" *ngIf="product?.size"> <!-- Chỉ hiển thị nếu có size -->
                <span class="fw-medium">Size:</span>
                <span class="badge bg-secondary ms-1">{{ product.size }}</span>
                <span class="text-muted ms-2">({{ product.quantity }} sản phẩm có sẵn)</span> <!-- Hiển thị số lượng còn lại -->
           </p>
           <!-- Hiển thị nếu không có size hoặc không còn hàng -->
            <!-- <p class="product-stock mb-3" *ngIf="!product?.size || !product?.quantity || product.quantity <= 0">
               <span class="text-danger fw-medium">
                   <i class="fas fa-times-circle me-1"></i> Hết hàng
               </span>
            </p>             -->
            <!-- Số lượng & Nút bấm -->
            <div class="action-buttons mt-4">
                <button class="btn btn-primary btn-lg me-2"
                        (click)="addToCart()" 
                        [disabled]="!product || product.quantity <= 0"> 
                    <i class="fas fa-cart-plus me-2"></i> Thêm vào giỏ hàng
                </button>
                
                <button class="btn btn-success btn-lg"
                        [disabled]="!product || product.quantity <= 0"
                        (click)="buyNow(product)" > 
                    Mua ngay
                </button>
            </div>

             <!-- Thông tin thêm -->
             <div class="extra-info mt-4 border-top pt-3">
                 <small class="text-muted d-block mb-1">Mã sản phẩm: {{ product.serialId }}</small>
                 <small class="text-muted d-block mb-1">Ngày đăng: {{ product.createdDate | date:'dd/MM/yyyy' }}</small>

             </div>

        </div>
    </div>
    <div *ngIf="product?.description && !isLoading && !errorMessage" class="product-details mt-5"> <!-- Chỉ hiện khi có mô tả -->
        <hr class="section-divider">
        <h4 class="section-title">Mô tả chi tiết</h4>
        <!-- Thêm class 'whitespace-preline' để xử lý xuống dòng -->
        <p class="description-text whitespace-preline">
            {{ product?.description ?? 'Chưa có mô tả chi tiết.' }}
        </p>
    </div>

</div>

<app-footer></app-footer>